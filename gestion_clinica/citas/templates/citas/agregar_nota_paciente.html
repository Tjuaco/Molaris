{% extends 'citas/base.html' %}

{% block title %}Editar Notas - {{ paciente.nombre_completo }}{% endblock %}

{% block page_title %}<i class="fas fa-edit"></i> Editar Notas{% endblock %}
{% block page_subtitle %}Agregar o modificar las notas médicas de {{ paciente.nombre_completo }}{% endblock %}

{% block content %}
<div class="section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2><i class="fas fa-sticky-note"></i> Notas Médicas</h2>
        <a href="{% url 'detalle_paciente' paciente.id %}" class="btn btn-info">
            <i class="fas fa-arrow-left"></i>
            <span>Volver al Paciente</span>
        </a>
    </div>
    
    <!-- Información del Paciente -->
    <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 24px;">
        <h3 style="margin-bottom: 12px; color: #1f2937; font-size: 1rem;">
            <i class="fas fa-user"></i> Paciente: {{ paciente.nombre_completo }}
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; font-size: 0.875rem;">
            <div>
                <span style="color: #6b7280;">Email:</span>
                <span style="color: #1f2937; font-weight: 500;">{{ paciente.email }}</span>
            </div>
            <div>
                <span style="color: #6b7280;">Teléfono:</span>
                <span style="color: #1f2937; font-weight: 500;">{{ paciente.telefono }}</span>
            </div>
            <div>
                <span style="color: #6b7280;">Registro:</span>
                <span style="color: #1f2937; font-weight: 500;">{{ paciente.fecha_registro|date:"d/m/Y" }}</span>
            </div>
        </div>
    </div>
    
    <!-- Formulario de Notas -->
    <form method="post" style="background: white; padding: 24px; border-radius: 8px; border: 1px solid #e2e8f0;">
        {% csrf_token %}
        
        <div style="margin-bottom: 20px;">
            <label for="notas" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                <i class="fas fa-sticky-note"></i> Notas Médicas
            </label>
            <textarea 
                id="notas" 
                name="notas" 
                rows="12" 
                style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem; line-height: 1.5; resize: vertical;"
                placeholder="Ingresa las notas médicas del paciente, incluyendo diagnósticos, tratamientos, observaciones, alergias, medicamentos, etc..."
            >{{ paciente.notas|default:"" }}</textarea>
            <div style="margin-top: 8px; font-size: 0.75rem; color: #6b7280;">
                <i class="fas fa-info-circle"></i> 
                Puedes incluir información sobre diagnósticos, tratamientos, medicamentos, alergias, observaciones importantes, etc.
            </div>
        </div>
        
        <!-- Botones de Acción -->
        <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 16px; border-top: 1px solid #e5e7eb;">
            <a href="{% url 'detalle_paciente' paciente.id %}" class="btn btn-info">
                <i class="fas fa-times"></i>
                <span>Cancelar</span>
            </a>
            <button type="submit" class="btn btn-success">
                <i class="fas fa-save"></i>
                <span>Guardar Notas</span>
            </button>
        </div>
    </form>
    
    <!-- Sugerencias -->
    <div style="background: #fef3c7; padding: 16px; border-radius: 8px; border: 1px solid #fde68a; margin-top: 20px;">
        <h4 style="color: #92400e; margin-bottom: 12px; font-size: 0.875rem;">
            <i class="fas fa-lightbulb"></i> Sugerencias para las notas médicas:
        </h4>
        <ul style="color: #92400e; font-size: 0.875rem; line-height: 1.6; margin-left: 20px;">
            <li>Diagnósticos y condiciones médicas</li>
            <li>Tratamientos realizados y planificados</li>
            <li>Medicamentos recetados y dosis</li>
            <li>Alergias conocidas</li>
            <li>Observaciones importantes del comportamiento del paciente</li>
            <li>Recomendaciones para futuras citas</li>
            <li>Historial de procedimientos dentales</li>
        </ul>
    </div>
</div>

{% block extra_js %}
<script>
    // Auto-resize del textarea
    const textarea = document.getElementById('notas');
    
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
    
    // Contador de caracteres
    const charCount = document.createElement('div');
    charCount.style.cssText = 'margin-top: 8px; font-size: 0.75rem; color: #6b7280; text-align: right;';
    textarea.parentNode.appendChild(charCount);
    
    function updateCharCount() {
        const count = textarea.value.length;
        charCount.textContent = `${count} caracteres`;
    }
    
    textarea.addEventListener('input', updateCharCount);
    updateCharCount();
</script>
{% endblock %}
{% endblock %}


