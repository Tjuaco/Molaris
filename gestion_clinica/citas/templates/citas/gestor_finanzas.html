{% extends 'citas/base.html' %}
{% load custom_filters %}

{% block title %}Gestor de Finanzas - Clínica Dental{% endblock %}

{% block page_title %}{% endblock %}
{% block page_subtitle %}{% endblock %}

{% block content %}
<div class="personal-container">
    <!-- Header -->
    <div class="header-with-stats">
        <div class="page-header">
            <h1 class="page-title"><i class="fas fa-dollar-sign"></i> Gestor de Finanzas</h1>
            <p class="page-subtitle">Ingresos y egresos de la clínica</p>
        </div>
    </div>

    <!-- Tabs de Navegación -->
    <div class="finanzas-tabs">
        <button class="finanzas-tab-btn active" data-tab="ingresos" onclick="mostrarTab('ingresos')">
            <i class="fas fa-arrow-up"></i>
            <span>Ingresos</span>
        </button>
        <button class="finanzas-tab-btn" data-tab="egresos" onclick="mostrarTab('egresos')">
            <i class="fas fa-arrow-down"></i>
            <span>Egresos</span>
        </button>
    </div>

    <!-- Tab: Ingresos -->
    <div id="tab-ingresos" class="finanzas-tab-content active">
        <!-- Estadísticas de Ingresos -->
        <div class="finanzas-stats-grid">
            <div class="finanzas-stat-card">
                <div class="finanzas-stat-icon" style="background: var(--primary-color);">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="finanzas-stat-content">
                    <div class="finanzas-stat-label">Ingresos Totales</div>
                    <div class="finanzas-stat-value">{{ total_ingresos|pesos_chilenos }}</div>
                </div>
            </div>
            
            <div class="finanzas-stat-card">
                <div class="finanzas-stat-icon" style="background: var(--primary-color);">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="finanzas-stat-content">
                    <div class="finanzas-stat-label">Ingresos del Mes</div>
                    <div class="finanzas-stat-value">{{ ingresos_mes|pesos_chilenos }}</div>
                </div>
            </div>
            
            <div class="finanzas-stat-card">
                <div class="finanzas-stat-icon" style="background: var(--primary-color);">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="finanzas-stat-content">
                    <div class="finanzas-stat-label">Ingresos del Año</div>
                    <div class="finanzas-stat-value">{{ ingresos_año|pesos_chilenos }}</div>
                </div>
            </div>
            
            <div class="finanzas-stat-card">
                <div class="finanzas-stat-icon" style="background: var(--primary-color);">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="finanzas-stat-content">
                    <div class="finanzas-stat-label">Citas Completadas</div>
                    <div class="finanzas-stat-value">{{ total_citas_completadas }}</div>
                </div>
            </div>
        </div>

        <!-- Ingresos por Mes (Compacto) -->
        <div class="finanzas-card-compact">
            <div class="finanzas-card-header-compact">
                <h3><i class="fas fa-chart-bar" style="color: var(--primary-color); font-size: 16px;"></i> Ingresos por Mes</h3>
            </div>
            <div class="finanzas-card-body-compact">
                {% if ingresos_por_mes %}
                <div class="mes-grid-compact">
                    {% for mes_data in ingresos_por_mes %}
                    <div class="mes-item-compact">
                        <div class="mes-nombre-compact">{{ mes_data.mes }}</div>
                        <div class="mes-valor-compact">{{ mes_data.ingresos|pesos_chilenos }}</div>
                        <div class="mes-citas-compact">{{ mes_data.citas }} citas</div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state-compact">
                    <i class="fas fa-info-circle"></i>
                    <p>No hay ingresos registrados aún.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Registros de Ingresos -->
        <div class="finanzas-card">
            <div class="finanzas-card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3><i class="fas fa-list" style="color: var(--primary-color);"></i> Registros de Ingresos</h3>
                <button onclick="mostrarModal('modalIngresoManual')" class="btn-agregar-finanzas" style="background: var(--primary-color); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <i class="fas fa-plus"></i> Agregar
                </button>
            </div>
            <div class="finanzas-card-body">
                {% if todos_ingresos %}
                <table class="table-finanzas-simple">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Descripción</th>
                            <th>Monto</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in todos_ingresos %}
                        <tr>
                            <td>
                                {% if item.tipo == 'cita' %}
                                    {{ item.cita.fecha_hora|date:"d/m/Y H:i" }}
                                {% else %}
                                    {{ item.ingreso_manual.fecha|date:"d/m/Y" }}
                                {% endif %}
                            </td>
                            <td>
                                {% if item.tipo == 'cita' %}
                                    {% if item.cita.tipo_servicio %}
                                        {{ item.cita.tipo_servicio.nombre }}
                                    {% else %}
                                        {{ item.cita.tipo_consulta|default:"Cita" }}
                                    {% endif %}
                                    <small style="display: block; color: #64748b; font-size: 0.75rem;">
                                        <i class="fas fa-calendar-check"></i> Cita Completada
                                    </small>
                                {% else %}
                                    {{ item.ingreso_manual.descripcion }}
                                    <small style="display: block; color: #64748b; font-size: 0.75rem;">
                                        <i class="fas fa-hand-holding-usd"></i> Ingreso Manual
                                    </small>
                                {% endif %}
                            </td>
                            <td class="text-right precio-cell">{{ item.monto|pesos_chilenos }}</td>
                            <td class="text-center">
                                {% if item.tipo == 'ingreso_manual' %}
                                    <a href="{% url 'eliminar_ingreso_manual' item.ingreso_manual.id %}" onclick="return confirm('¿Estás seguro de eliminar este ingreso manual?');" class="btn-eliminar-finanzas" style="color: #ef4444; text-decoration: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;" title="Eliminar ingreso manual">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                {% elif item.tipo == 'cita' %}
                                    <a href="{% url 'eliminar_ingreso_cita' item.cita.id %}" onclick="return confirm('¿Estás seguro de eliminar este ingreso de la cita del historial financiero? La cita se mantendrá pero no aparecerá en los cálculos.');" class="btn-eliminar-finanzas" style="color: #ef4444; text-decoration: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;" title="Eliminar ingreso de cita">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                {% else %}
                                    <span style="color: #64748b; font-size: 12px;">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="empty-state-finanzas">
                    <i class="fas fa-info-circle"></i>
                    <p>No hay ingresos registrados aún.</p>
                </div>
                {% endif %}
            </div>
        </div>

    </div>

    <!-- Tab: Egresos -->
    <div id="tab-egresos" class="finanzas-tab-content">
        <!-- Estadísticas de Egresos -->
        <div class="finanzas-stats-grid">
            <div class="finanzas-stat-card">
                <div class="finanzas-stat-icon" style="background: #ef4444;">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="finanzas-stat-content">
                    <div class="finanzas-stat-label">Egresos Totales</div>
                    <div class="finanzas-stat-value" style="color: #ef4444;">{{ total_egresos|pesos_chilenos }}</div>
                </div>
            </div>
            
            <div class="finanzas-stat-card">
                <div class="finanzas-stat-icon" style="background: #ef4444;">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="finanzas-stat-content">
                    <div class="finanzas-stat-label">Egresos del Mes</div>
                    <div class="finanzas-stat-value" style="color: #ef4444;">{{ egresos_mes|pesos_chilenos }}</div>
                </div>
            </div>
            
            <div class="finanzas-stat-card">
                <div class="finanzas-stat-icon" style="background: #ef4444;">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="finanzas-stat-content">
                    <div class="finanzas-stat-label">Egresos del Año</div>
                    <div class="finanzas-stat-value" style="color: #ef4444;">{{ egresos_año|pesos_chilenos }}</div>
                </div>
            </div>
            
            <div class="finanzas-stat-card">
                <div class="finanzas-stat-icon" style="background: var(--primary-color);">
                    <i class="fas fa-balance-scale"></i>
                </div>
                <div class="finanzas-stat-content">
                    <div class="finanzas-stat-label">Balance</div>
                    <div class="finanzas-stat-value" style="color: {% if balance_total >= 0 %}var(--primary-color){% else %}#ef4444{% endif %};">
                        {{ balance_total|pesos_chilenos }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Egresos por Mes (Compacto) -->
        <div class="finanzas-card-compact">
            <div class="finanzas-card-header-compact">
                <h3><i class="fas fa-chart-bar" style="color: #ef4444; font-size: 16px;"></i> Egresos por Mes</h3>
            </div>
            <div class="finanzas-card-body-compact">
                {% if egresos_por_mes %}
                <div class="mes-grid-compact">
                    {% for mes_data in egresos_por_mes %}
                    <div class="mes-item-compact">
                        <div class="mes-nombre-compact">{{ mes_data.mes }}</div>
                        <div class="mes-valor-compact" style="color: #ef4444;">{{ mes_data.egresos|pesos_chilenos }}</div>
                        <div class="mes-citas-compact">{{ mes_data.movimientos }} registros</div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state-compact">
                    <i class="fas fa-info-circle"></i>
                    <p>No hay egresos registrados aún.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Registros de Egresos -->
        <div class="finanzas-card">
            <div class="finanzas-card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3><i class="fas fa-list" style="color: #ef4444;"></i> Registros de Egresos</h3>
                <button onclick="mostrarModal('modalEgresoManual')" class="btn-agregar-finanzas" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <i class="fas fa-plus"></i> Agregar
                </button>
            </div>
            <div class="finanzas-card-body">
                {% if movimientos_recientes or egresos_manuales %}
                <table class="table-finanzas-simple">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Descripción</th>
                            <th>Cantidad</th>
                            <th>Total</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in movimientos_recientes %}
                        <tr>
                            <td>
                                {% if item.tipo == 'compra' %}
                                    {{ item.movimiento.fecha_movimiento|date:"d/m/Y H:i" }}
                                {% elif item.tipo == 'solicitud' %}
                                    {{ item.solicitud.fecha_solicitud|date:"d/m/Y H:i" }}
                                {% else %}
                                    {{ item.egreso_manual.fecha|date:"d/m/Y" }}
                                {% endif %}
                            </td>
                            <td>
                                {% if item.tipo == 'compra' %}
                                    {{ item.movimiento.insumo.nombre|default:"Sin nombre" }}
                                    <small style="display: block; color: #64748b; font-size: 0.75rem;">
                                        <i class="fas fa-box"></i> Compra
                                    </small>
                                {% elif item.tipo == 'solicitud' %}
                                    {{ item.solicitud.insumo.nombre|default:"Sin nombre" }}
                                    <small style="display: block; color: #64748b; font-size: 0.75rem;">
                                        <i class="fas fa-paper-plane"></i> Solicitud
                                    </small>
                                {% else %}
                                    {{ item.egreso_manual.descripcion }}
                                    <small style="display: block; color: #64748b; font-size: 0.75rem;">
                                        <i class="fas fa-hand-holding-usd"></i> Egreso Manual
                                    </small>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if item.tipo == 'compra' %}
                                    {{ item.movimiento.cantidad }} {{ item.movimiento.insumo.unidad_medida|default:"" }}
                                {% elif item.tipo == 'solicitud' %}
                                    {{ item.solicitud.cantidad_solicitada }} {{ item.solicitud.insumo.unidad_medida|default:"" }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td class="text-right precio-cell" style="color: #ef4444;">
                                {% if item.total > 0 %}
                                    {{ item.total|pesos_chilenos }}
                                {% else %}
                                    Sin precio
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if item.tipo == 'egreso_manual' %}
                                    <a href="{% url 'eliminar_egreso_manual' item.egreso_manual.id %}" onclick="return confirm('¿Estás seguro de eliminar este egreso manual?');" class="btn-eliminar-finanzas" style="color: #ef4444; text-decoration: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;" title="Eliminar egreso manual">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                {% elif item.tipo == 'compra' %}
                                    <a href="{% url 'eliminar_egreso_compra' item.movimiento.id %}" onclick="return confirm('¿Estás seguro de eliminar esta compra del historial financiero? El movimiento se eliminará completamente.');" class="btn-eliminar-finanzas" style="color: #ef4444; text-decoration: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;" title="Eliminar compra">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                {% elif item.tipo == 'solicitud' %}
                                    <a href="{% url 'eliminar_egreso_solicitud' item.solicitud.id %}" onclick="return confirm('¿Estás seguro de eliminar este egreso de solicitud del historial financiero? La solicitud se mantendrá pero no aparecerá en los cálculos.');" class="btn-eliminar-finanzas" style="color: #ef4444; text-decoration: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;" title="Eliminar egreso de solicitud">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                {% else %}
                                    <span style="color: #64748b; font-size: 12px;">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="empty-state-finanzas">
                    <i class="fas fa-info-circle"></i>
                    <p>No hay egresos registrados aún.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
/* ============================================================================
   ESTILOS PARA GESTOR DE FINANZAS
   ============================================================================ */

.personal-container {
    padding: 0;
}

/* Tabs de Navegación */
.finanzas-tabs {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    border-bottom: 2px solid #e2e8f0;
}

.finanzas-tab-btn {
    padding: 12px 24px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    color: #64748b;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    margin-bottom: -2px;
}

.finanzas-tab-btn:hover {
    color: var(--primary-color);
    background: var(--primary-bg);
}

.finanzas-tab-btn.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
}

.finanzas-tab-btn i {
    font-size: 16px;
}

/* Contenido de Tabs */
.finanzas-tab-content {
    display: none;
}

.finanzas-tab-content.active {
    display: block;
}

/* Estadísticas */
.finanzas-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}

.finanzas-stat-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border: 2px solid #e2e8f0;
    transition: all 0.3s ease;
}

.finanzas-stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    border-color: var(--primary-light);
}

.finanzas-stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    flex-shrink: 0;
}

.finanzas-stat-content {
    flex: 1;
}

.finanzas-stat-label {
    font-size: 12px;
    color: #64748b;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}

.finanzas-stat-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary-color);
}

/* Tarjetas */
.finanzas-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border: 2px solid #e2e8f0;
    margin-bottom: 24px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.finanzas-card:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    border-color: var(--primary-light);
}

.finanzas-card-header {
    padding: 20px 24px;
    background: var(--primary-bg);
    border-bottom: 2px solid #e2e8f0;
}

.finanzas-card-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 10px;
}

.finanzas-card-body {
    padding: 24px;
}

/* Tabla Simple */
.table-finanzas-simple {
    width: 100%;
    border-collapse: collapse;
}

.table-finanzas-simple thead {
    background: var(--primary-bg);
}

.table-finanzas-simple thead th {
    padding: 12px 16px;
    text-align: left;
    font-size: 13px;
    font-weight: 600;
    color: var(--primary-text);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid var(--primary-light);
}

.table-finanzas-simple tbody tr {
    border-bottom: 1px solid #e2e8f0;
    transition: all 0.2s ease;
}

.table-finanzas-simple tbody tr:hover {
    background: var(--primary-bg);
}

.table-finanzas-simple tbody td {
    padding: 14px 16px;
    font-size: 14px;
    color: #1e293b;
}

.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

.precio-cell {
    font-weight: 700;
    color: var(--primary-color);
    font-size: 15px;
}

/* Estado Vacío */
.empty-state-finanzas {
    text-align: center;
    padding: 60px 20px;
    color: #64748b;
}

.empty-state-finanzas i {
    font-size: 48px;
    color: #cbd5e1;
    margin-bottom: 16px;
    display: block;
}

.empty-state-finanzas p {
    margin: 0;
    font-size: 15px;
    color: #64748b;
}

/* Estilos para secciones compactas */
.finanzas-card-compact {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border: 2px solid #e2e8f0;
    margin-bottom: 24px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.finanzas-card-compact:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    border-color: var(--primary-light);
}

.finanzas-card-header-compact {
    padding: 12px 16px;
    background: var(--primary-bg);
    border-bottom: 2px solid #e2e8f0;
}

.finanzas-card-header-compact h3 {
    margin: 0;
    font-size: 15px;
    font-weight: 600;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 8px;
}

.finanzas-card-body-compact {
    padding: 16px;
}

.mes-grid-compact {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 12px;
}

.mes-item-compact {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 10px 12px;
    text-align: center;
    transition: all 0.2s ease;
}

.mes-item-compact:hover {
    background: var(--primary-bg);
    border-color: var(--primary-light);
    transform: translateY(-2px);
}

.mes-nombre-compact {
    font-size: 11px;
    color: #64748b;
    font-weight: 600;
    text-transform: uppercase;
    margin-bottom: 6px;
    letter-spacing: 0.5px;
}

.mes-valor-compact {
    font-size: 16px;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 4px;
}

.mes-citas-compact {
    font-size: 11px;
    color: #94a3b8;
}

.empty-state-compact {
    text-align: center;
    padding: 20px;
    color: #64748b;
}

.empty-state-compact i {
    font-size: 32px;
    color: #cbd5e1;
    margin-bottom: 8px;
    display: block;
}

.empty-state-compact p {
    margin: 0;
    font-size: 13px;
    color: #64748b;
}

/* Responsive */
@media (max-width: 768px) {
    .finanzas-stats-grid {
        grid-template-columns: 1fr;
    }
    
    .finanzas-tabs {
        flex-direction: column;
        gap: 0;
    }
    
    .finanzas-tab-btn {
        width: 100%;
        justify-content: center;
        border-bottom: 1px solid #e2e8f0;
        border-left: 3px solid transparent;
        border-right: none;
    }
    
    .finanzas-tab-btn.active {
        border-left-color: var(--primary-color);
        border-bottom-color: #e2e8f0;
    }
}
</style>

<script>
function mostrarTab(tabName) {
    // Ocultar todos los contenidos
    document.querySelectorAll('.finanzas-tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Remover active de todos los botones
    document.querySelectorAll('.finanzas-tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Mostrar el tab seleccionado
    document.getElementById('tab-' + tabName).classList.add('active');
    document.querySelector('[data-tab="' + tabName + '"]').classList.add('active');
}

// Funciones para modales
function mostrarModal(modalId) {
    document.getElementById(modalId).classList.add('show');
    document.body.style.overflow = 'hidden';
}

function cerrarModal(modalId) {
    document.getElementById(modalId).classList.remove('show');
    document.body.style.overflow = '';
}
</script>

<!-- Modal: Agregar Ingreso Manual -->
<div id="modalIngresoManual" class="modal-finanzas">
    <div class="modal-content-finanzas">
        <div class="modal-header-finanzas">
            <h3><i class="fas fa-plus-circle"></i> Agregar Ingreso Manual</h3>
            <button onclick="cerrarModal('modalIngresoManual')" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #64748b;">&times;</button>
        </div>
        <form method="post" action="{% url 'agregar_ingreso_manual' %}">
            {% csrf_token %}
            <div class="modal-body-finanzas">
                <div class="form-group-finanzas">
                    <label>Monto *</label>
                    <input type="number" name="monto" step="1" min="1" required class="form-control-finanzas" placeholder="0">
                </div>
                <div class="form-group-finanzas">
                    <label>Descripción *</label>
                    <input type="text" name="descripcion" required class="form-control-finanzas" placeholder="Ej: Venta de productos, Servicio adicional...">
                </div>
                <div class="form-group-finanzas">
                    <label>Fecha *</label>
                    <input type="date" name="fecha" required class="form-control-finanzas" value="{% now 'Y-m-d' %}">
                </div>
                <div class="form-group-finanzas">
                    <label>Notas</label>
                    <textarea name="notas" rows="3" class="form-control-finanzas" placeholder="Notas adicionales..."></textarea>
                </div>
            </div>
            <div class="modal-footer-finanzas">
                <button type="button" onclick="cerrarModal('modalIngresoManual')" class="btn-secondary-finanzas">Cancelar</button>
                <button type="submit" class="btn-primary-finanzas">Guardar Ingreso</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal: Agregar Egreso Manual -->
<div id="modalEgresoManual" class="modal-finanzas">
    <div class="modal-content-finanzas">
        <div class="modal-header-finanzas">
            <h3><i class="fas fa-plus-circle"></i> Agregar Egreso Manual</h3>
            <button onclick="cerrarModal('modalEgresoManual')" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #64748b;">&times;</button>
        </div>
        <form method="post" action="{% url 'agregar_egreso_manual' %}">
            {% csrf_token %}
            <div class="modal-body-finanzas">
                <div class="form-group-finanzas">
                    <label>Monto *</label>
                    <input type="number" name="monto" step="1" min="1" required class="form-control-finanzas" placeholder="0">
                </div>
                <div class="form-group-finanzas">
                    <label>Descripción *</label>
                    <input type="text" name="descripcion" required class="form-control-finanzas" placeholder="Ej: Pago de servicios, Alquiler, Mantenimiento...">
                </div>
                <div class="form-group-finanzas">
                    <label>Fecha *</label>
                    <input type="date" name="fecha" required class="form-control-finanzas" value="{% now 'Y-m-d' %}">
                </div>
                <div class="form-group-finanzas">
                    <label>Notas</label>
                    <textarea name="notas" rows="3" class="form-control-finanzas" placeholder="Notas adicionales..."></textarea>
                </div>
            </div>
            <div class="modal-footer-finanzas">
                <button type="button" onclick="cerrarModal('modalEgresoManual')" class="btn-secondary-finanzas">Cancelar</button>
                <button type="submit" class="btn-primary-finanzas">Guardar Egreso</button>
            </div>
        </form>
    </div>
</div>

<style>
/* Estilos para modales de finanzas */
.modal-finanzas {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.modal-finanzas.show {
    display: flex;
}

.modal-content-finanzas {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

.modal-header-finanzas {
    padding: 20px 24px;
    border-bottom: 2px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--primary-bg);
    border-radius: 12px 12px 0 0;
}

.modal-header-finanzas h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 10px;
}

.modal-body-finanzas {
    padding: 24px;
}

.form-group-finanzas {
    margin-bottom: 20px;
}

.form-group-finanzas label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #374151;
    font-size: 14px;
}

.form-control-finanzas {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.2s ease;
}

.form-control-finanzas:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.modal-footer-finanzas {
    padding: 20px 24px;
    border-top: 2px solid #e2e8f0;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
}

.btn-primary-finanzas {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 14px;
}

.btn-primary-finanzas:hover {
    background: var(--primary-dark);
}

.btn-secondary-finanzas {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 14px;
}

.btn-secondary-finanzas:hover {
    background: #e5e7eb;
}

.btn-eliminar-finanzas:hover {
    background: #fee2e2;
}
</style>
{% endblock %}
