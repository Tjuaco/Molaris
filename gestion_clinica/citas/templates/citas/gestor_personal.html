{% extends 'citas/base.html' %}

{% block title %}Gestión de Personal - Clínica Dental{% endblock %}

{% block page_title %}{% endblock %}
{% block page_subtitle %}{% endblock %}

{% block content %}
<div class="personal-container">
    <!-- Header con Stats a la Derecha -->
    <div class="header-with-stats">
        <div class="page-header">
            <h1 class="page-title"><i class="fas fa-users"></i> Gestión de Personal</h1>
            <p class="page-subtitle">Administra el equipo de trabajo de la clínica dental</p>
        </div>
        <div class="dashboard-compact">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon total">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ estadisticas.total_personal }}</div>
                        <div class="stat-label">Total Personal</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon dentistas">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ estadisticas.dentistas }}</div>
                        <div class="stat-label">Dentistas Activos</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon administrativos">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ estadisticas.administrativos }}</div>
                        <div class="stat-label">Administrativos</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon nuevos">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ estadisticas.nuevos_este_mes }}</div>
                        <div class="stat-label">Nuevos este mes</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Barra de Acciones y Filtros -->
    <div class="actions-bar">
        <div class="search-filters">
            <form method="GET" class="filter-form">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" name="search" placeholder="Buscar por nombre, email, teléfono..." value="{{ search }}">
</div>

                <select name="rol" class="filter-select">
                    <option value="">Todos los roles</option>
                    {% for value, label in roles %}
                        <option value="{{ value }}" {% if rol == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
                
                <select name="estado" class="filter-select">
                    <option value="">Todos los estados</option>
                    <option value="activo" {% if estado == 'activo' %}selected{% endif %}>Activos</option>
                    <option value="inactivo" {% if estado == 'inactivo' %}selected{% endif %}>Inactivos</option>
                </select>
                
                <button type="submit" class="btn-filter">
                    <i class="fas fa-filter"></i> Filtrar
                </button>
                
                {% if search or rol or estado %}
                <a href="{% url 'gestor_personal' %}" class="btn-clear">
                    <i class="fas fa-times"></i> Limpiar
                </a>
                {% endif %}
            </form>
        </div>
        
        <button class="btn-add-personal" onclick="openAddModal()">
            <i class="fas fa-user-plus"></i>
            Agregar Personal
        </button>
    </div>

    <!-- Tabla de Personal -->
    <div class="personal-table-container">
        <table class="personal-table">
            <thead>
                <tr>
                    <th><i class="fas fa-user"></i> Personal</th>
                    <th><i class="fas fa-briefcase"></i> Rol</th>
                    <th><i class="fas fa-envelope"></i> Contacto</th>
                    <th><i class="fas fa-calendar"></i> Registro</th>
                    <th><i class="fas fa-toggle-on"></i> Estado</th>
                    <th class="text-center"><i class="fas fa-cog"></i> Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for persona in personal %}
                <tr class="personal-row {% if not persona.activo %}inactive-row{% endif %}">
                    <td>
                        <div class="personal-info">
                            <div class="avatar">
                                {% if persona.foto %}
                                    <img src="{{ persona.foto.url }}" alt="{{ persona.nombre_completo }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                                {% else %}
                                    <i class="fas fa-{% if persona.rol == 'dentista' %}user-md{% else %}user-tie{% endif %}"></i>
                                {% endif %}
                            </div>
                            <div class="info">
                                <strong>{{ persona.nombre_completo }}</strong>
                                {% if persona.especialidad %}
                                <span class="especialidad">{{ persona.especialidad }}</span>
                                {% elif not persona.requiere_acceso_sistema %}
                                <span class="especialidad" style="color: #6b7280;">
                                    <i class="fas fa-user-slash"></i> Sin acceso al sistema
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="badge-rol {% if persona.rol == 'dentista' %}badge-dentista{% else %}badge-admin{% endif %}">
                            <i class="fas fa-{% if persona.rol == 'dentista' %}user-md{% else %}user-tie{% endif %}"></i>
                            {{ persona.get_rol_display }}
                        </span>
                    </td>
                    <td>
                        <div class="contact-info">
                            <div><i class="fas fa-envelope"></i> {{ persona.email }}</div>
                            <div><i class="fas fa-phone"></i> {{ persona.telefono }}</div>
                        </div>
                    </td>
                    <td>
                        <span class="date-info">{{ persona.fecha_registro|date:"d/m/Y" }}</span>
                    </td>
                    <td>
                        <span class="status-badge {% if persona.activo %}status-active{% else %}status-inactive{% endif %}">
                            <i class="fas fa-circle"></i>
                            {% if persona.activo %}Activo{% else %}Inactivo{% endif %}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a href="{% url 'editar_personal' persona.id %}" class="btn-action btn-edit" title="Editar">
                                <i class="fas fa-edit"></i>
                            </a>
                            {% if persona.rol == 'dentista' %}
                            <a href="{% url 'gestionar_horario_dentista' persona.id %}" class="btn-action btn-horario" title="Gestionar Horario" style="background: var(--primary-color); color: white;">
                                <i class="fas fa-clock"></i>
                            </a>
                            {% endif %}
                            <button onclick="eliminarPersonal({{ persona.id }}, '{{ persona.nombre_completo }}')" class="btn-action btn-delete" title="Eliminar">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="empty-state">
                        <i class="fas fa-users-slash"></i>
                        <p>No se encontró personal</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal Agregar Personal -->
<div id="addPersonalModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-user-plus"></i> Agregar Nuevo Personal</h2>
            <button class="close-btn" onclick="closeAddModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form method="POST" action="{% url 'agregar_personal' %}" id="addPersonalForm" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- Checkbox para indicar si requiere acceso al sistema -->
                <div class="form-group full-width" style="margin-bottom: 20px; padding: 16px; background: var(--primary-bg); border-radius: 8px; border: 2px solid var(--primary-color);">
                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; font-weight: 600; color: var(--primary-text);">
                        <input type="checkbox" name="requiere_acceso_sistema" id="requiere_acceso_checkbox" checked onchange="toggleAccesoSistema()">
                        <span><i class="fas fa-key"></i> Este personal requiere acceso al sistema</span>
                    </label>
                    <small style="display: block; margin-top: 8px; color: #64748b; margin-left: 32px;">
                        Desmarque esta opción para personal como limpieza, mantenimiento, etc. que no necesitan credenciales de acceso.
                    </small>
                </div>
                
                <div class="form-grid">
                    <!-- Campos de usuario y contraseña (se ocultan si no requiere acceso) -->
                    <div id="credenciales_container" style="display: contents;">
                        <div class="form-group">
                            <label><i class="fas fa-user"></i> Nombre de Usuario *</label>
                            <input type="text" name="username" id="username_input" placeholder="usuario123">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-lock"></i> Contraseña *</label>
                            <input type="password" name="password" id="password_input" placeholder="********" minlength="8">
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label><i class="fas fa-id-card"></i> Nombre Completo *</label>
                        <input type="text" name="nombre_completo" required placeholder="Juan Pérez García">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Email *</label>
                        <input type="email" name="email" required placeholder="usuario@ejemplo.com">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-phone"></i> Teléfono *</label>
                        <input type="tel" name="telefono" required placeholder="+56 9 1234 5678">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-briefcase"></i> Rol *</label>
                        <select name="rol" required onchange="toggleDentistaFields()">
                            <option value="">Seleccionar...</option>
                            <option value="dentista">Dentista</option>
                            <option value="administrativo">Administrativo</option>
                            <option value="general">General (Acceso Completo)</option>
                        </select>
                    </div>
                    
                    <!-- Campo para foto (opcional) -->
                    <div class="form-group full-width">
                        <label><i class="fas fa-camera"></i> Foto del Personal (Opcional)</label>
                        <input type="file" name="foto" accept="image/*" id="foto_input" onchange="previewFoto(event)">
                        <small style="display: block; margin-top: 4px; color: #64748b;">
                            Formatos permitidos: JPG, PNG, GIF. Tamaño máximo: 5MB
                        </small>
                        <div id="foto_preview" style="margin-top: 12px; display: none;">
                            <img id="preview_img" style="max-width: 150px; max-height: 150px; border-radius: 8px; border: 2px solid #e5e7eb;">
                        </div>
                    </div>
                </div>

                <div id="dentista-fields" style="display: none;">
                    <div class="form-grid">
                        <div class="form-group">
                            <label><i class="fas fa-stethoscope"></i> Especialidad</label>
                            <select name="especialidad">
                                <option value="">Seleccionar...</option>
                                <option value="General">Odontología General</option>
                                <option value="Ortodoncia">Ortodoncia</option>
                                <option value="Endodoncia">Endodoncia</option>
                                <option value="Periodoncia">Periodoncia</option>
                                <option value="Cirugía">Cirugía Oral</option>
                            </select>
                    </div>

                        <div class="form-group">
                            <label><i class="fas fa-id-badge"></i> Número de Colegio</label>
                            <input type="text" name="numero_colegio" placeholder="12345">
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeAddModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-save"></i> Guardar Personal
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.personal-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px 40px;
}

/* Stats Dashboard */
.stats-dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    display: flex;
    align-items: center;
    gap: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
}

.stat-icon {
    width: 64px;
    height: 64px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: white;
}

.stat-icon.total {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-darker));
}

.stat-icon.dentistas {
    background: linear-gradient(135deg, #10b981, #059669);
}

.stat-icon.administrativos {
    background: linear-gradient(135deg, #f59e0b, #d97706);
}

.stat-icon.nuevos {
    background: linear-gradient(135deg, #8b5cf6, #6d28d9);
}

.stat-info h3 {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
    color: #1f2937;
}

.stat-info p {
    margin: 4px 0 0;
    color: #6b7280;
    font-size: 0.95rem;
    font-weight: 500;
}

.stat-info small {
    color: #9ca3af;
    font-size: 0.875rem;
}

/* Actions Bar */
.actions-bar {
    background: white;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    flex-wrap: wrap;
}

.search-filters {
    flex: 1;
    min-width: 300px;
}

.filter-form {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
}

.search-box {
    position: relative;
    flex: 1;
    min-width: 250px;
}

.search-box i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
}

.search-box input {
    width: 100%;
    padding: 10px 12px 10px 40px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.95rem;
    transition: all 0.2s ease;
}

.search-box input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.filter-select {
    padding: 10px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.95rem;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary-color);
}

.btn-filter, .btn-clear {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
}

.btn-filter {
    background: var(--primary-color);
    color: white;
}

.btn-filter:hover {
    background: var(--primary-dark);
}

.btn-clear {
    background: #6b7280;
    color: white;
}

.btn-clear:hover {
    background: #4b5563;
}

.btn-add-personal {
    padding: 12px 24px;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1rem;
}

.btn-add-personal:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

/* Tabla de Personal */
.personal-table-container {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.personal-table {
    width: 100%;
    border-collapse: collapse;
}

.personal-table thead {
    background: linear-gradient(135deg, #1f2937, #111827);
    color: white;
}

.personal-table th {
    padding: 16px;
    text-align: left;
    font-weight: 600;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.personal-table th i {
    margin-right: 8px;
    opacity: 0.8;
}

.personal-table tbody tr {
    border-bottom: 1px solid #e5e7eb;
    transition: all 0.2s ease;
}

.personal-table tbody tr:hover {
    background: #f9fafb;
}

.personal-table tbody tr.inactive-row {
    opacity: 0.6;
}

.personal-table td {
    padding: 16px;
}

.personal-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-darker));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
}

.info strong {
    display: block;
    color: #1f2937;
    font-size: 0.95rem;
    margin-bottom: 2px;
}

.especialidad {
    font-size: 0.875rem;
    color: #6b7280;
}

.badge-rol {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
}

.badge-dentista {
    background: #dbeafe;
    color: #1e40af;
}

.badge-admin {
    background: #fef3c7;
    color: #92400e;
}

.contact-info div {
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 4px;
}

.contact-info i {
    width: 16px;
    color: #9ca3af;
}

.date-info {
    color: #6b7280;
    font-size: 0.875rem;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
}

.status-active {
    background: #d1fae5;
    color: #065f46;
}

.status-inactive {
    background: #fee2e2;
    color: #991b1b;
}

.status-badge i {
    font-size: 0.5rem;
}

.action-buttons {
    display: flex;
    gap: 6px;
    justify-content: center;
}

.btn-action {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
}

.btn-view {
    background: #dbeafe;
    color: #1e40af;
}

.btn-view:hover {
    background: var(--primary-color);
    color: white;
}

.btn-edit {
    background: #fef3c7;
    color: #92400e;
}

.btn-edit:hover {
    background: #f59e0b;
    color: white;
}

.btn-key {
    background: #e0e7ff;
    color: #3730a3;
}

.btn-key:hover {
    background: #6366f1;
    color: white;
}

.btn-calendar {
    background: #d1fae5;
    color: #065f46;
}

.btn-calendar:hover {
    background: #10b981;
    color: white;
}

.btn-delete {
    background: #fee2e2;
    color: #991b1b;
    border: none;
    cursor: pointer;
}

.btn-delete:hover {
    background: #ef4444;
    color: white;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #9ca3af;
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 16px;
}

.empty-state p {
    font-size: 1.1rem;
    margin: 0;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    align-items: center;
    justify-content: center;
}

.modal.show {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 16px;
    width: 90%;
    max-width: 700px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    padding: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    gap: 12px;
}

.close-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.3);
}

.modal-body {
    padding: 32px;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-group.full-width {
    grid-column: 1 / -1;
}

.form-group label {
    font-weight: 600;
    color: #374151;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-group label i {
    color: #10b981;
}

.form-group input,
.form-group select {
    padding: 12px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.95rem;
    transition: all 0.2s ease;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #10b981;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.modal-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    padding-top: 24px;
    border-top: 2px solid #e5e7eb;
}

.btn-cancel,
.btn-submit {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-cancel {
    background: #6b7280;
    color: white;
}

.btn-cancel:hover {
    background: #4b5563;
}

.btn-submit {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
}

.btn-submit:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.text-center {
    text-align: center;
}

/* Responsive */
@media (max-width: 1024px) {
    .actions-bar {
        flex-direction: column;
        align-items: stretch;
    }
    
    .btn-add-personal {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 768px) {
    .stats-dashboard {
        grid-template-columns: 1fr;
    }
    
    .personal-table-container {
        overflow-x: auto;
    }
    
    .personal-table {
        min-width: 800px;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        width: 95%;
    }
    
    .modal-body {
        padding: 20px;
    }
}
</style>

<script>
function openAddModal() {
    document.getElementById('addPersonalModal').classList.add('show');
    document.body.style.overflow = 'hidden';
}

function closeAddModal() {
    document.getElementById('addPersonalModal').classList.remove('show');
    document.body.style.overflow = '';
}

function toggleDentistaFields() {
    const rolSelect = document.querySelector('select[name="rol"]');
    const dentistaFields = document.getElementById('dentista-fields');
    
    if (rolSelect && dentistaFields) {
        dentistaFields.style.display = rolSelect.value === 'dentista' ? 'block' : 'none';
    }
}

function toggleAccesoSistema() {
    const checkbox = document.getElementById('requiere_acceso_checkbox');
    const usernameInput = document.getElementById('username_input');
    const passwordInput = document.getElementById('password_input');
    const credencialesContainer = document.getElementById('credenciales_container');
    
    if (checkbox.checked) {
        // Requiere acceso al sistema - mostrar y hacer obligatorios los campos
        credencialesContainer.style.display = 'contents';
        usernameInput.required = true;
        passwordInput.required = true;
    } else {
        // No requiere acceso al sistema - ocultar y hacer opcionales los campos
        credencialesContainer.style.display = 'none';
        usernameInput.required = false;
        passwordInput.required = false;
        usernameInput.value = '';
        passwordInput.value = '';
    }
}

function previewFoto(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('foto_preview');
    const previewImg = document.getElementById('preview_img');
    
    if (file && file.type.match('image.*')) {
        const reader = new FileReader();
        reader.onload = function(e) {
            previewImg.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        preview.style.display = 'none';
    }
}

// Cerrar modal con ESC (clic fuera deshabilitado en cambio anterior)
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeAddModal();
    }
});

// Función para eliminar personal
function eliminarPersonal(personalId, nombreCompleto) {
    if (confirm(`¿Estás seguro de que deseas eliminar a "${nombreCompleto}" del sistema?\n\nEsta acción NO se puede deshacer.`)) {
        // Crear formulario para enviar POST
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/trabajadores/eliminar_personal/${personalId}/`;
        
        // Agregar token CSRF
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = csrfToken;
        form.appendChild(csrfInput);
        
        // Enviar formulario
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
